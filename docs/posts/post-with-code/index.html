<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Faustine Corbani">
<meta name="dcterms.date" content="2024-05-11">

<title>Faustine Corbani PSY504 Final - Using NLP to Identify Topic Shifts in Spontaneous Thought</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Faustine Corbani PSY504 Final</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">Faustine Corbani</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/fcorbani" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Using NLP to Identify Topic Shifts in Spontaneous Thought</h1>
                                <div class="quarto-categories">
                <div class="quarto-category">NLP</div>
                <div class="quarto-category">clustering</div>
                <div class="quarto-category">analysis</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Faustine Corbani </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 11, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<p>Our minds rarely sit still. Whether we’re walking, eating, working, or socializing, our minds are continuously roving through a mental landscape of thoughts, memories, plans, fantasies, and reflections. Studies suggest that we spend between 30-50% of our waking hours engaging in these spontaneous thoughts.</p>
<p>Given the ubiquity of spontaneous thought, it’s essential that we develop tools to quantify and analyze people’s streams of thoughts. In this blog post, I will detail one such tool: how we can leverage natural language processing (NLP) and topic modeling to identify topic jumps within a transcribed stream of thoughts. Prior research has observed a “clump-and-jump” structure in thought, where thoughts cluster around a specific theme before transitioning, at times abruptly, to a new, unrelated topic. Prior work has relied on human annotation to identify instances when thoughts shift from one topic to the next. However, this method is unfeasible in large datasets. This blog post will detail how advancements in NLP and topic modeling can automate the detection of these transitions. Specifically, in this tutorial, I will use Python to apply clustering algorithms to segment thoughts extracted from verbal data to visualize and analyze the dynamics of spontaneous thought more efficiently.</p>
<p>In this tutorial, I will be using a dataset of 746 subjects who were were instructed to narrate their stream of thought in real time, saying whatever is going through your mind from moment to moment for 10 minutes. The result is a dataframe where each row corresponds to a subject and there is a column called ‘sentences’ which contains a list of strings, where each string corresponds to a thought.</p>
<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">Set-Up</h2>
<p>First, you need to load the following packages &amp; your data.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sentence_transformers <span class="im">import</span> SentenceTransformer</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.cluster.hierarchy <span class="im">import</span> linkage, fcluster</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> ast</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> umap</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> tabulate <span class="im">import</span> tabulate</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.cluster <span class="im">import</span> KMeans</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> os</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>path_to_data <span class="op">=</span> <span class="st">"/Users/faustinecorbani/Desktop/emotion_thought/data/semi-clean/subject_level_dynamic_measures.csv"</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>data <span class="op">=</span> pd.read_csv(path_to_data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(data.head(), headers<span class="op">=</span><span class="st">'keys'</span>, tablefmt<span class="op">=</span><span class="st">'psql'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+----+--------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------+----------------------------+------------------------------+------------------------+-----------------------+------------------------+-----------------------+----------------------+-----------------------+------------------------+-----------------------+------------------------+-----------------------------+------------------------------+-----------------+----------------+-----------------+------------------------------+-----------------------------+------------------------------+------------------+-----------------------+-------------------------+------------------------------+--------------------------------+--------------------------+--------------------------+----------------------------+----------------------+--------------+-----------------------------+------------------+--------------+--------------------+----------------------------+---------------------------------------+---------------------------------------+-----------------------------------+-----------------------------------+--------------------------+----------------------------+----------------------+-----------------------------------+-----------------------------------+----------------------------+--------------+-------+--------------+------------------+-----------------------------------------+---------------------------------------+------------------------------+---------------------------------+--------------------+--------------------------+--------------------+--------------+---------------------+----------------+---------------------------------------+------------+--------------+
|    | subject_id               | sentences                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |   First_Last_Similarity |   average_clustering_coeff |   characteristic_path_length |   negative_to_negative |   negative_to_neutral |   negative_to_positive |   neutral_to_negative |   neutral_to_neutral |   neutral_to_positive |   positive_to_negative |   positive_to_neutral |   positive_to_positive |   proportion_within_valence |   proportion_between_valence |   MNWT_negative |   MNWT_neutral |   MNWT_positive |   negative_thought_frequency |   neutral_thought_frequency |   positive_thought_frequency |   censorThoughts |   easeOfThinkingAloud |   frequencyOfRunningOut |   post_induction_rationality |   post_induction_social_impact |   post_induction_valence |   post_think_rationality |   post_think_social_impact |   post_think_valence | recallType   |   similarityToDailyThoughts |   brooding_score |   CESD_score |   loneliness_score |   online_interaction_total |   post_induction_PANAS_Positive_Score |   post_induction_PANAS_Negative_Score |   post_think_PANAS_Positive_Score |   post_think_PANAS_Negative_Score |   difference_rationality |   difference_social_impact |   difference_valence |   difference_PANAS_Positive_Score |   difference_PANAS_Negative_Score |   social_interaction_total |   STAI_score |   age | gender_tri   |   income_ordinal |   Average_Subsequent_Thought_Similarity |   Average_Previous_Thought_Similarity |   Average_Overall_Similarity |   average_time_between_thoughts |   total_word_count |   average_thought_length |   mean_sia_valence |   speech_end |   total_speech_time |   speech_start |   Average_Similarity_to_First_Thought |   MNWT_all |   n_thoughts |
|----+--------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------+----------------------------+------------------------------+------------------------+-----------------------+------------------------+-----------------------+----------------------+-----------------------+------------------------+-----------------------+------------------------+-----------------------------+------------------------------+-----------------+----------------+-----------------+------------------------------+-----------------------------+------------------------------+------------------+-----------------------+-------------------------+------------------------------+--------------------------------+--------------------------+--------------------------+----------------------------+----------------------+--------------+-----------------------------+------------------+--------------+--------------------+----------------------------+---------------------------------------+---------------------------------------+-----------------------------------+-----------------------------------+--------------------------+----------------------------+----------------------+-----------------------------------+-----------------------------------+----------------------------+--------------+-------+--------------+------------------+-----------------------------------------+---------------------------------------+------------------------------+---------------------------------+--------------------+--------------------------+--------------------+--------------+---------------------+----------------+---------------------------------------+------------+--------------|
|  0 | 5397a6bbfdf99b1ccc3f1219 | ['Feeling calm.', 'Feeling excited for this week.', 'Feeling frustrated.', 'Not liking being stuck inside.', "There's a lot of us outside.", 'Hearing footsteps.', 'I feel calm.', 'Thinking about work.', "And I'm at my break room.", "I'm in my class that I'm taking.", "I feel a little anxious about the project I'm working on for school.", "I'm going to look at that.", "I'm going to look at the things I took down today.", 'I gave you about two hours.', "I'm going to clean that.", 'more ovatious.', "Thinking about what we've had thinking about what we need to make for lunch very confused really worried about medical things about talking to the doctor Do not wander away.", 'No terror.', 'Just thinking about physical symptoms.', 'Do not be in pain.', "what book you're reading.", "I'm going to read one today.", "It's called... about my friend's birthday tomorrow.", 'I need to call her.', 'More pristine.', 'Forward.', 'writing.', "I'm about writing in my planner.", 'I have to... special office week.', 'I have to move out of my house.', "Let's get gas for the car.", 'Check the brakes.', 'Check tire pressure.', 'Check bag level.', 'Payday.', 'Get groceries on Friday.', 'Nothing.', 'Distraction.', 'We need to check my email after this.', 'Computer.', 'Content.', 'Table.', 'Groceries.', 'Snow.', 'nice dreamy nature happy digital happy content are still here', 'excel problems moving anxious need to be honest a little more Coffee.', 'Time.', 'Computer.', 'Keys.', "making coffee making food doing the steps I need to do to make food to do my tissues brushing my teeth I'm going to have first breakfast I need to call a dentist.", 'I need to call a dentist.', 'I need to make an appointment with a dentist.', 'I need to do my physical therapy.', 'Hungry.', 'Hungry.', 'Tired.', "I'm thinking about right now."]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |               0.308858  |                  0.141719  |                     0.835962 |               0.25     |              0.75     |               0        |              0.125    |             0.75     |              0.125    |              0.125     |              0.625    |               0.25     |                    0.596491 |                     0.403509 |          7.125  |        4.63415 |          6      |                    0.140351  |                    0.719298 |                     0.140351 |               13 |                    24 |                       3 |                           37 |                             57 |                       78 |                       68 |                         42 |                   58 | positive     |                          62 |               11 |           39 |                 17 |                          2 |                                    32 |                                    10 |                                24 |                                13 |                       31 |                        -15 |                  -20 |                                -8 |                                 3 |                          3 |            9 |    29 | Other        |                2 |                                0.271764 |                              0.272    |                     0.163037 |                        4.26055  |                295 |                  5.93051 |         0.00777018 |      579.634 |             338.039 |          3.004 |                              0.263358 |    5.17544 |           57 |
|  1 | 5484655ffdf99b07b28f22cc | ["Well I'm kind of a multitasker or multitasker.", "And so I've got a bunch of things running through my mind.", "I don't think I'm bipolar because I can concentrate like I'm doing well concentrating on this study.", "And that's generally the case for me.", 'I can do a task and', 'do really well with it.', "But I've got a lot of things going on.", "I'm right here Missouri and the Midwest but it's unseasonably cold.", 'It was minus six degrees Fahrenheit this morning which I suppose would be something like minus eighteen or something or twenty or something Celsius depending on where you are and Very economical is how I heat my house and city utilities has been asking us to be economical', 'But I hate my house.', 'I was eating my house with heat lamps but', 'this the heat lamps are just not doing it', "So I'm having to use a little space heater that I used last year", 'and I turned my oven on', 'And I have thermometers all around the house.', "I'm kind of keeping track of that and it's in my mind that I to keep checking the ones and make sure that the faucets are dripping and that nothing's frozen.", "But so far and I even have thermometers stuck down in the crawl space so I can kind of keep track of what's going on down there.", "Everything's been doing really well.", 'And I think it was even minus ten or eleven Fahrenheit here a day or so ago.', "We've been on a cold snap now for about four or five days.", "We're going to get some respite tomorrow.", "We're going to get some respite tomorrow.", "And um for a couple of days and then it's going to be cold again for a couple three days and then it'll be back to being seasonal which will be like you know thirty or forty during the day maybe twenty or something at night which is real easy to manage.", 'But anyway I got that running on my mind.', "Um I am it's getting close to lunchtime.", 'I always look forward to lunch.', 'Um I have bought some new Skechers shoes and', "I'm trying to decide whether to keep them or not.", 'It feels like perhaps I should take them back.', "They feel not too bad but they're much more close around my foot than I'm used to with shoes.", "And I'm not certainly I couldn't wear more than one pair of socks in this kind of weather in them.", "And so I'm not sure they're the right thing.", "I'm also I do these studies like I'm doing here with you and", "I've gotten asked the question a couple of times in the about you section of Prolific have you ever considered creating a non fungible or a Non fungible token NFT whatever.", "I think it's non fungible token.", "I'm kind of new to that", "but anyway I've been researching that and", "I'm thinking I've got some art that I created digital art", 'and I think I ought to try to create one', "and I have a grandson that's a really high-tech for a fifteen-year-old.", 'He tries to create websites and', 'does create some.', 'He created a website for his mother for her art that she sells and she was a realtor.', 'He created a website for that I believe.', "So anyway that's in the back of my mind.", 'I want to get back to reading about that.', "I'm also a Course in Miracles student.", 'I really enjoy studying the course.', "As I mentioned earlier I don't know whether you're keeping track of the various parts of this survey or not but I'm in recovery.", "I've been in recovery.", "If I make it and I don't have any reason to think I won't by February seventh I'll be twenty years clean and sober.", 'And so I learned a lot about surrender and', 'learning how to live happy joyous and free there.', 'And prior to that and concomitant with that I was a very active Christian and', "had read the Bible I don't know thirty forty times something like that.", 'The New Testament probably fifty or a hundred times.', 'The full Bible probably twenty-five times or something.', 'And had a real idea of what it is to live in a non-dual way as a Christian.', 'And then the Course in Miracles just has put the final touches on it.', 'So we have a group we get together and', 'do some meditation for about ten minutes reading a book called Come Breathe With Me.', "that a person that's very dear to my heart wrote.", "And then we she doesn't but", 'the rest of us stay for another ten or fifteen minutes and look at the daily workbook lesson from A Course in Miracles and discuss it.', 'And we do that morning and evening.', 'That is very rewarding.', 'I facilitate several classes for the ACIM community.', 'ACIM stands for A Course in Miracles community.', 'And so I upload and', 'download about twenty-five videos a week or', 'I download and upload about twenty-five videos a week as a volunteer position but I really enjoy that.', 'And I facilitate a group or', 'at least I open a group and', 'I sometimes facilitate it on Saturdays for the same group of people.', 'And we go to some classes there.', 'I go to well two or three classes anyway in the what we call total transformation community and', "There's one called Helen's notes which is", 'Values written a book about the scribe of a course in miracles that has some insight as to what was going on with her while she was writing the course as well as the course itself embedded in it I think or a lot of stuff about the course and', "And one of the leaders there suggested that we read the use of terms or clarification of terms from A Course in Miracles which I've read a few times before.", "But he was suggesting that there's a lot that a person could get out of it and", "he's been reading it every day for I don't know several days now.", 'So I thought I would join him in that in the sense of reading it.', "And so I've got it in a PDF reader and", "I'm going through it.", 'When I read something I study it like I did in graduate school.', 'you know so I could really kind of assimilate it into my thinking and be able to use it later.', "So I'm annotating the PDF file with notes and that's very fascinating.", "I'm looking forward to getting back to that.", "I'm looking forward to getting back to I'm doing some research.", "I've been using for the last year or so CHAT GPT and more recently the last several months BARD AI.", 'And I asked BARD AI', "what's the least expensive most expeditious way to make an NFT for the least price just kind of for fun and to see what it's like.", "And I'm interested in getting back to those recommendations.", "In fact I'm reading one of the references that BARD gave me.", "as another thing that's going on.", "I'm excited about several things that happened.", 'One of my fobs for my Honda van went out and', 'I was talking to a guy at work about how expensive they were.', 'And he said oh no no no.', 'Find it online and', "there's how to do it how to program it yourself online.", 'So I found one for', 'And I programmed it yesterday', "and it's working.", 'And so wow fifteen dollars and', "I've got a replacement fob for my Honda.", "So that's pretty cool and I'm kind of excited about playing with that some more.", 'I like to go walk at the Nature Center.', 'I went out and', 'walked yesterday and it was like all of I think it was seven to eight degrees Fahrenheit but I wrapped up just perfectly as guided by the Holy Spirit or the higher power.', 'And I was very comfortable in the walk and it was just a delightful two point five mile walk.', 'And my insurance company is going to buy me sports equipment.', 'give me money to just buy things so I bought a', "I already had a one that wasn't working very well", "so I bought a little better Fitbit Versa four and I'm learning how to use it trying to decide whether I'm going to keep it or not because I can return it.", 'It also will pay for some shoes.', "I bought some Skechers shoes but I'm not sure they're fitting quite right.", 'And I may have to return them.', "But both places that I bought them from are good on returns and so it shouldn't be any trouble.", 'And I just moored them around the house to get to see how they were going to feel.', 'I always do that with shoes.', "Before I get some kind of shoe that's going to really hurt my foot.", "So I'm looking forward to getting that taken care of.", 'So wow', "I don't know what I can think of much else.", 'I mean I can go into talking about how much I love the course.', "Well I'm supposed to join with a guy tonight from...", 'I join with people all over the world.', 'I join with one guy from Sydney and', "we discuss what we're learning in the Course in Miracles and another guy that's in New Hampshire and what's going on with him and then there's another guy that I join with in Alberta Canada in Edmonton.", 'Those are all once a week.', "But we talk where we're at with living in the light and joy and peace that abides in our consciousness.", "and how that's the truth of who we are and that's all we are and how we're doing with that or if we're getting caught up in the believing the illusion of Maya M-A-Y-A I'm not sure why that word's said it's more of a Buddhist or Oriental word of course talking about the illusion of the world and the Samadhi or true truth of who we really are.", 'So we talk about that.', "And then I have a friend that I've been connected with.", 'In fact we almost got married at one time about five years ago.', "We've kind of since downgraded that to just a really good friendship.", 'But we join every day at six thirty my time in the evening and', "discuss the same kind of thing I'm talking about here.", 'So I always look forward to doing that.', 'So I just have so many things I look forward to doing.', 'always just having a joyful life.', 'I substitute teach with high school students.', 'I really enjoy interacting with them and', 'we have a good time.', 'So thank you.', "I think I'm about out of time here so take care.", 'Peace and joy.', 'Thanks for letting me rattle'] |               0.178291  |                  0.0844627 |                     0.883858 |               0.222222 |              0.333333 |               0.444444 |              0.0375   |             0.5625   |              0.4      |              0.0677966 |              0.542373 |               0.389831 |                    0.469799 |                     0.530201 |         12.4444 |        9.8     |         15.6667 |                    0.0604027 |                    0.536913 |                     0.402685 |                2 |                    98 |                       2 |                           59 |                             95 |                       94 |                       59 |                         98 |                   98 | negative     |                          97 |                5 |           21 |                 12 |                          4 |                                    39 |                                    10 |                                44 |                                10 |                        0 |                          3 |                    4 |                                 5 |                                 0 |                          4 |            6 |    75 | Male         |                5 |                                0.290804 |                              0.292318 |                     0.116064 |                        0.530966 |               1836 |                  3.47982 |         0.16768    |      600.026 |             518.493 |          2.95  |                              0.144112 |   12.3221  |          149 |
|  2 | 549b8ef4fdf99b4ffa5fa0c9 | ["I'm happy content energetic joyful grateful.", 'My feelings maybe a little ignored.', 'I feel ignored.', "I guess that's a feeling.", "I feel just like people don't see me which is True sadly.", 'So confused.', "I feel confused as to why I'm so invisible to people.", 'But I still feel overall grateful and happy.', "I feel like I can't control other people's feelings or perceptions of me.", 'So for the most part I do my best to just ignore it and go on.', 'I feel excited.', 'Slightly nervous.', 'Just mostly happy.', 'I feel happy that twenty twenty three is over and ready to start living through twenty twenty four.', 'I feel Sometimes a bit sad not too much though.', 'Concerned perhaps concerned is a better description.', "Concerned for humanity if it's going to be lost forever for the most part which is what I'm concerned about.", "People's behaviors are irrational and narcissistic overall.", 'from my general neighborhood throughout the global world it seems.', "I feel though that I am safe where I'm at in my house and places that I go to.", 'Occasionally lonely but usually not too bad.', 'Maybe a bit frustrated just frustrated with the ghost syndrome that I have.', "Which I'm not sure why because I'm decent enough looking I wear fairly bright clothes but there's nothing about me really that is ghost-like.", "So I don't really understand why.", "So it's just more confusion.", 'I feel that always every day of my life is the confusion of how I can be unseen so often and so well by people.', 'I mean I was saying I could have wings fly out of my butt and fly around the room', 'and nobody would notice.', "And it's pretty true.", "They just wouldn't notice.", 'So it does lead to frustration that I live most of my life.', 'They only notice.', 'People tend to only notice.', 'when I do something wrong.', 'And then they choose to point it out to me in the most annoying aggravating way possible.', 'And they never notice their own shortcomings and only their own strengths and greatness.', "But a lot of that is just the area that I live in is that way that I will the culture of the state has and apparently maybe always will be that women don't matter especially by other women.", "Even worse probably but they don't matter.", "They're meant to be kept as possessions and slaves. Yeah.", "And that if you just don't fit in with their group male or female you but especially females you will be unseen unloved uncared for.", "And it's tragic.", 'But I just make my way and', 'make my best that I can.', 'So mostly I tend to be positive and happy.', "Because I can't really do much to change it.", "I don't know how you're not allowed to discuss it you're not allowed to act like it exists or else you are the problem.", 'And I live in a state that has some of the highest crime rates in the country.', 'The most problems the Poverty level is one of the worst.', "We're always in the top three of the worst the worst state to do this.", "And we're always at the bottom of the list typically the best state to do this.", 'But apparently everybody loves the weather which is fine decent nice enough weather.', "It's nice not to be at negative at negative fifteen.", 'but it is dry and windy a lot.', "So I've been in places where the weather is so much better and the scenery is so much better but there's a certain beauty to it and niceness.", "But if people love it the environment and everything here it makes me wonder why they're not happier overall.", "Why they have a look of murder in their eyes about ninety-nine percent of their life why they're so cold-hearted and cruel and unkind and fill up their days inside of their house smoking pot and drinking beer while watching the game on TV.", "So it's a mystery but", "I think a lot of it is just a distraction so they don't have to solve the problems.", "Because if you say to somebody there's a problem here they will tell you no there's not.", "It doesn't exist.", 'There is no problem.', 'Typically of course.', 'So that leads to lots of frustration every day.', 'Not just today but every day.', 'But usually I just try to realize that I am here and look at the good things in my life and not worry so much about what everybody else is out there doing or feeling.', 'Because they sadly are a predominantly psychopathic culture and psychopathic population.', "So it's a little rough to live here and it's hard to find people to go out with.", "I've lived here", 'lived here most of my life forty years forty one years left for six years which is why I know that not every place is like this in spite of what people despite of what people tell you.', 'But I have had Very few friends.', "And in the past twenty-four years from the age of twenty-four to now forty-eight I've had virtually no friends cannot make a friend couldn't purchase a friend could not pay someone to be my friend.", "Which is crazy because I've tried.", "I've actually tried to pay people to go with me places or somewhere and", 'they refuse it.', "And they won't go for free.", "So it's not like they're just like no no you don't need to pay me Let's go together anyway.", "No it's like no", "I won't.", "I don't want your money.", "And no I don't want to go with you.", 'And so it is a very isolated.', 'People isolate themselves.', "They stick only to their family and people that they've known since birth.", 'And everybody else is a threat or a problem or someone to fight or someone to steal from.', 'or murder or rape.', 'So yeah this is really really crazy here.', 'But that is why I feel frustrated.', "And people say why don't you move?", 'Well I have family here.', 'My child is here and', "I can't move with my child.", "My child doesn't live with me right now.", 'So maybe but I also have a place that I really love.', 'So that helped.', 'I have a place that I go to that I really love with people that actually usually see that I exist.', "Still don't mean friends but not really friends like you hang out with.", 'But they actually see that I exist and are polite and kind to me.', 'So that is huge.', 'That is huge.', 'And I sort of have a friend like an actual friend now from there.', 'But in the regular world here no I gave up.', 'I will never no matter what I do really I will not make a friend or even a relationship anymore.', "I'm divorced now.", 'And to them forty-eight years old is about thirty-five years past your prime and your ability to be with someone which is crazy and illegal.', 'But who cares?', "They don't care.", 'I care.', 'I care but', "they don't care so whatever.", "That's about it.", 'My feelings.', 'Mostly surprisingly is gratitude joy happiness peace excitement.']                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |               0.620477  |                  0.123682  |                     0.855821 |               0.46     |              0.28     |               0.26     |              0.461538 |             0.192308 |              0.346154 |              0.428571  |              0.2      |               0.371429 |                    0.366071 |                     0.633929 |         12.18   |        7.15385 |         11.5556 |                    0.446429  |                    0.232143 |                     0.321429 |                0 |                    76 |                       1 |                           67 |                             89 |                       86 |                       41 |                         86 |                   74 | negative     |                          83 |               10 |           28 |                 20 |                          3 |                                    38 |                                    15 |                                39 |                                21 |                      -26 |                         -3 |                  -12 |                                 1 |                                 6 |                          5 |            9 |    48 | Female       |                6 |                                0.290327 |                              0.291756 |                     0.144162 |                        0.80755  |               1211 |                  4.50626 |        -0.0280929  |      598.29  |             504.961 |          2.35  |                              0.151082 |   10.8125  |          112 |
|  3 | 558823c2fdf99b318cb4224b | ["Okay for the next ten minutes I'll be recording myself.", "Well I don't have a lot to say.", 'I guess I can just kind of reiterate my week and speak about my week coming up.', "But yeah I mean my mother's planning a big vacation trip and", 'I got a lot of stuff to do today especially in helping her out.', 'So hopefully I can accomplish those things.', 'I mean the days are a bit more stressful now but getting through them is fun.', 'And even doing tasks like this like I appreciate being able to you know earn for myself just by you know giving off my own thoughts and', "that's considered data to someone and valuable to someone.", 'So I find that intriguing.', 'Who knows though?', 'Who really knows?', "I don't know.", 'What did I do this past week?', "I mean I've been working a lot just in preparation of this week and", "I've got a ton on my mind.", "So it's weird.", "Like I would be able to just ramble and whatnot but it's you know humans have a governor where we don't want to get too personal with things cause it's no one's business but our own really.", "But yeah I've got a lot of stuff on my head.", "I've been dealing with stuff for a long time but these past couple of years of maybe not a couple of years but this past like Year or maybe half year seven months or something's been tough because I broke my leg in a way.", 'I had ankle reconstruction.', 'So That was unique and just kind of adapting To my to my life before the injury has been a challenge', "and Yeah honestly I'm kind of in the phases of like where I'm kind of like I'm not fully healthy again But I feel a lot better than I did last year not being able to walk etc.", 'So I', "That's that's nice.", "So I don't know one interesting thing.", 'I notice is that Time kind of maybe not passes more quickly but', 'it makes me more comfortable with time seeing this like blue banner', "So that's super interesting I guess I Guess I'm already like a quarter of the way through even though it doesn't really feel like that but", "what's a quarter of ten minutes only two and a half minutes doesn't really feel like I've been rambling for two and a half minutes but Assume the first two or three minutes is always going to be the easiest because I have the most thoughts going on in my head but", "Yeah there's just a lot of little things just the little things even my headset I have an expensive headset but like one of the headphones is like sounding like it's going out and I'm just wondering why it is for such an expensive headset to already be doing this when I only got it like in the end of the little things like that get on my nerves and just kind of take over my mind they occupy my mind for sure just cuz I guess", 'but this is definitely interesting', "I guess it's cathartic in a way I wish I was more interesting", "I mean I don't really do much but work", 'I mean I do watch things I play games and whatnot but', "I don't know I get bored of myself just talking.", "It's weird.", "I don't really have anything.", 'The prompt said that I should say anything that just kind of comes to my head but', "I don't know if that means like ramble for ten minutes but I mean if it does then so be it.", "That's cool I guess.", 'I do have my day planned out.', "So hopefully it's a good day.", 'Hopefully I can enjoy myself.', "Uh I don't know.", 'Kind of just counting the days lately.', "I'm older now so you know I'm thirty four but", "I like I still don't feel it which is not necessarily a good thing cause I should start feeling my age.", "I guess I'm kind of immature in that way.", "This is gonna be a funny little listen back for whoever's listening to this.", 'My mind is everywhere.', 'I have bad ADD so I can be talking about games one second and then just really anything the next.', "So you know but that's maybe not such a bad thing.", 'Who knows?', 'I have so much to do yet', "it always feels like I don't.", "I'm always looking for ways to do just other things than what I have to do.", "I don't know why life is always like that for me.", 'I always feel constrained by things I have to do.', "When I really shouldn't I should be grateful and actively completing these things.", "But I am on Prolific doing this so that's a start.", "It's only a good thing earning money and you know providing for myself and doing that.", 'And I love prolific.', "I've I've never done as interesting of things uh you know right from my living room like this and", 'even talking to other people from around the world and doing interesting unique things.', "I can't complain.", "I'm a millennial so.", 'I think I appreciate more of the advancements in technology et cetera as opposed to like being against them.', "Like some people in my life like even my mom not really into technology or being forward thinking because I think even my mom would like doing stuff like this but sometimes it's just like even the technical stuff like clicking a button and knowing where to click or knowing where to navigate it's not always.", "It's not always easy for people who didn't like grow up with it.", 'I guess in a way I was lucky to grow up with a computer.', "And I can't really imagine Gen X or Gen Z like growing up uh growing up literally with like a mobile phone and a tablet.", 'I mean I got that when I was like and my first phone I guess when I was like fourteen and whatnot', "so I don't know how and that was that was like a bare bones phone with like snake on it and stuff", 'and that was ahead of its time back then', "so I just don't know kids are all over the place wild evolution is how life is nowadays Ten minutes is usually a long time and it feels like I've been talking for a while but it's weird.", "I don't know sometimes ten minutes can feel like an absolute eternity and", 'sometimes like now it can feel bearable.', "Maybe just because I'm good at rambling or something I don't know.", 'Maybe not good at it just I can do it consistently without getting super tired.', "Yeah I don't know.", "Just finding really anything to talk about I guess is good Who knows I have so many things to do I've gotten a lot of things done", 'but I still have so much to do Man', 'oh man', "oh man Not a bad thing though I like having things to do I just I don't like being lazy and not doing them", 'but I have to.', 'Hopefully this has been recording well and', "no one's going insane listening to me or anything.", "I don't know I probably would go insane listening to myself talk.", "Yeah I don't know maybe I talk myself out.", "Like it's so funny so many things will come to my head after I like log off this but", "right now it's just like I can never talk on the in the moment or whatever I don't know.", "It's funny honestly.", "It's definitely been an interesting study though.", "Definitely unlike any other one I've taken before.", "I mean rambling for ten minutes that's definitely something I haven't like done before.", "But I don't mind it I guess."]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |               0.0999998 |                  0.160186  |                     0.831447 |               0.153846 |              0.307692 |               0.538462 |              0.133333 |             0.4      |              0.466667 |              0.132075  |              0.283019 |               0.584906 |                    0.463918 |                     0.536082 |         17.8462 |        7.54839 |         16.1887 |                    0.134021  |                    0.319588 |                     0.546392 |               42 |                    61 |                       4 |                           67 |                             27 |                       22 |                       73 |                         33 |                   31 | negative     |                          68 |               11 |           50 |                 20 |                         15 |                                    25 |                                    21 |                                33 |                                18 |                        6 |                          6 |                    9 |                                 8 |                                -3 |                          4 |           17 |    34 | Male         |                6 |                                0.277577 |                              0.277011 |                     0.168553 |                        0.883292 |               1324 |                  4.93155 |         0.224229   |      566.741 |             478.56  |          3.365 |                              0.156034 |   13.6495  |           97 |
|  4 | 55900dcffdf99b3f7aada3f5 | ["Guess this is on Currently we're where I'm in the fourth day of well third day I guess of House arrest in a sense House confinement anyway based on or due to the weather here Like probably a lot of the country.", "I'm in an area right on the edge of the this arctic blast we're getting", "but it's enough to make the roads undrivable and really difficult to walk in in particular", 'the area here got just enough rain and snow', "I guess it was about two or three days ago just enough to cover the all over the ground anywhere the roads and the sidewalks and the paths in the park with a nice couple of inches two or three maybe well probably around four maybe four or five inches of snow that then has then melted just a touch but just enough but never that the temperatures hasn't gone above freezing for all the entire time so walking on this kind of or driving is really difficult that's not I'm not used to this living in this kind of weather", 'So I have very little experience driving on ice.', "And the experience I've had was lucky I didn't crash my car.", 'I actually did crash it.', 'But it went into a snowbank so it was fine.', 'I was able to keep going but', "I got a quick lesson on how the brakes don't work if you're going too fast and you need to stop.", 'Anyway looking forward to this ending Looks like tonight.', "It's gonna be the last really big blast.", "We're gonna supposed to get more snow and sleep today but that around I guess going into tonight.", "It's actually the the temperature is actually going to start rising and", "it's going to actually hit above freezing sometime in the morning", "or no I mean in the evening as we hit the evening which normally the temperature goes down but tonight it's fortunately going to go up by tomorrow morning", 'and then the rains are going to come might still a little', "but mostly it's supposed to be rain And", "by tomorrow we're supposed to hit the forties.", "So hopefully uh since I have a dentist appointment tomorrow that required me to go several miles on a two lane road um hopefully that will be melted and um I'll be able to get to my dentist appointment.", 'I already the weather system already canceled a concert I was looking forward to.', 'It was actually four nights of a classical presentation but it got they had to send out every night', 'all four nights were canceled because of the weather.', "It's just not possible.", "It's just dangerous to be driving.", "And as I've found it's dangerous to be walking on that when the ice freezes over.", 'It was very difficult writing about that incident that I was asked to write about in the beginning.', "It's a very painful memory.", 'It really changed my life profoundly.', 'Not only my living situation but actually where I lived was living because it was very stressful.', "And I really didn't feel like getting into it because I was been talking about it the last a few months when it actually was sort of the anniversary of it happening.", "And some years you kind of don't really think about it too much but this year it was particularly um it would be it became something that um it's really noticeable.", "So something I wished I hadn't had to deal with this morning but", "that'll pass.", "It's funny how um The things you think of you read about stuff in the paper about people having these kinds of catastrophes how they have to experience these kinds of catastrophes.", "Sometimes it's a group of people or just one person or family.", "I always used to think jeez I just can't even imagine what that would be like.", "I really wonder if I even would have been able to survive it earlier in my life because it's I", "don't know It's not something that's easy to do Let's see what else", "Um It's kind of hard to uh usually if I'm talking I'm talking to someone.", "So there's a feedback here.", 'Just blabbing blabbing away is kind of uh difficult.', "It's not something it's kind of have to push myself to do it.", "Um lately I've been thinking a lot about this uh new I guess idea that sounds very new-agey but it's actually not.", 'There are actually physicists and philosophers who are talking about it.', "It's called panpsychism.", "It's one of those things that's sort of like the multi-worlds theory you know like there's several universes and all that.", "It's not in other words it's untestable.", "Currently it's untestable.", "There's no way to test it.", "It's the idea that consciousness is not just unique and not just it is very difficult to to identify specifically what it is how it works.", "I mean scientists don't really know from say how you get from rocks to humans.", 'Somewhere some spark of some sort something happened qualitatively.', 'Panpsychism is the idea that consciousness is a property of the universe just like gravity.', "It's a property of existence.", "I'm not so sure I believe that", "but I think there could be something to the consciousness being the same from plants to animals to bacteria that there's something there that's connected this when you're talking about life of some sort of form of life", "And there's one physicist I can't think of his name now but", "he's supposed to be one of the experts in space-time continuum.", "And he thinks that it has something to do with these I forget what they're called but it's a part of the human cell the neuron or maybe just cells that have certain characteristics of quantum mechanics.", 'And again this is totally untestable.', "And but he said it's he thinks that it's possible that that could be uh and because this is this is an all living things has has this and", 'he thinks that that could be the uh place to look or somewhere where we get a clue as to whether or not this is true or not.', "Won't happen probably in our lifetimes but it's an interesting thing to think about.", "I'm not going to start a new subject now because it looks like I'm running out of time.", "So I'll just sign off."]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |               0.0964044 |                  0.105178  |                     0.874881 |               0.368421 |              0.473684 |               0.157895 |              0.323529 |             0.470588 |              0.205882 |              0.0769231 |              0.769231 |               0.153846 |                    0.373134 |                     0.626866 |         20.0526 |       12.0286  |         21.0769 |                    0.283582  |                    0.522388 |                     0.19403  |               24 |                    75 |                       2 |                           49 |                             15 |                       42 |                       53 |                         41 |                   81 | negative     |                          73 |                7 |           28 |                 22 |                          0 |                                    33 |                                    13 |                                37 |                                10 |                        4 |                         26 |                   39 |                                 4 |                                -3 |                          0 |           10 |    73 | Male         |                3 |                                0.290042 |                              0.289761 |                     0.125119 |                        1.21203  |               1076 |                  7.57672 |        -0.0212955  |      594.078 |             507.64  |          6.444 |                              0.128491 |   16.0597  |           67 |
+----+--------------------------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+-------------------------+----------------------------+------------------------------+------------------------+-----------------------+------------------------+-----------------------+----------------------+-----------------------+------------------------+-----------------------+------------------------+-----------------------------+------------------------------+-----------------+----------------+-----------------+------------------------------+-----------------------------+------------------------------+------------------+-----------------------+-------------------------+------------------------------+--------------------------------+--------------------------+--------------------------+----------------------------+----------------------+--------------+-----------------------------+------------------+--------------+--------------------+----------------------------+---------------------------------------+---------------------------------------+-----------------------------------+-----------------------------------+--------------------------+----------------------------+----------------------+-----------------------------------+-----------------------------------+----------------------------+--------------+-------+--------------+------------------+-----------------------------------------+---------------------------------------+------------------------------+---------------------------------+--------------------+--------------------------+--------------------+--------------+---------------------+----------------+---------------------------------------+------------+--------------+</code></pre>
</div>
</div>
</section>
<section id="section" class="level2">
<h2 class="anchored" data-anchor-id="section"></h2>
</section>
<section id="understanding-sentence-transformers-and-embeddings" class="level2">
<h2 class="anchored" data-anchor-id="understanding-sentence-transformers-and-embeddings"><strong>Understanding Sentence Transformers and Embeddings</strong></h2>
<p>An important question in NLP is how to represent textual data in a format that computers can understand and work with easily. One solution is to convert language to numerical data through sentence embeddings, which encode pieces of text as high-dimensional vectors. These vectors capture meaningful semantic information, where sentences that are more similar to one another share more similar representations. This property is crucial for clustering and identifying relationships in large text corpora.</p>
<p>One popular approach to create sentence embeddings is to use pre-trained models that are able to take text as an input and output a vector corresponding to a sentence embedding. In this tutorial, I will use the pre-trained ‘all-mpnet-base-v2’ model from Hugging Face’s sentence-transformers library that maps sentences to a 768 dimensional dense vector space. I chose this model because it provides the best quality sentence embeddings per the platform’s model comparison and evaluation criteria (<a href="https://www.sbert.net/docs/pretrained_models.html" class="uri">https://www.sbert.net/docs/pretrained_models.html</a>).</p>
<p>The first step is to load our pre-trained sentence transformer model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>model <span class="op">=</span> SentenceTransformer(<span class="st">'sentence-transformers/all-mpnet-base-v2'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Next, we want to extract our sentence embeddings for each sentence . Let’s create a function that does this and run it for every subject:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> process_subject_data(subject_data):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    subject_sentences <span class="op">=</span> [sentence <span class="cf">for</span> sublist <span class="kw">in</span> subject_data[<span class="st">'sentences'</span>] <span class="cf">for</span> sentence <span class="kw">in</span> sublist]</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="kw">not</span> subject_sentences:</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> <span class="va">None</span>  <span class="co"># Return None if there are no sentences</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> model.encode(subject_sentences)  <span class="co"># Extract the embeddings for every sentence </span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Collect embeddings for all subjects</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>all_embeddings <span class="op">=</span> []</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>subject_ids <span class="op">=</span> []</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> name, group <span class="kw">in</span> data.groupby(<span class="st">'subject_id'</span>):</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    embeddings <span class="op">=</span> process_subject_data(group)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> embeddings <span class="kw">is</span> <span class="kw">not</span> <span class="va">None</span>:</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>        all_embeddings.append(embeddings)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>        subject_ids.extend([name] <span class="op">*</span> <span class="bu">len</span>(embeddings))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="dimensionality-reduction" class="level2">
<h2 class="anchored" data-anchor-id="dimensionality-reduction"><strong>Dimensionality Reduction</strong></h2>
<section id="what-is-the-curse-of-dimensionality" class="level3">
<h3 class="anchored" data-anchor-id="what-is-the-curse-of-dimensionality">What is the curse of dimensionality?</h3>
<p>The “curse of dimensionality” is a term often used within the machine learning literature to describe a challenge that emerges when working with data in high-dimensional spaces. As you add more dimensions a numerical representation, the space within which data points exist increases exponentially. A helpful analogy is to think of going from a line, to a square, to a cube: as each new dimension is added, you need increasingly more points to cover the space, resulting in more empty area. This makes clustering and classification tasks challenging since meaningful similarities in representation may become obfuscated. In addition, more dimensions require more computing power and time to process the data, and there is a risk of overfitting, where models might start to “learn” the noise in the data instead of the actual patterns, which can mislead predictions or classifications.</p>
<p>To overcome these issues, we can use dimensionality reduction to simplify the complexity of high-dimensional data while preserving its essential features. One such method is UMAP: Uniform Manifold Approximation and Projection. UMAP maps high-dimensional sentence embeddings to an n-dimensional space (here we will use 2 dimensions for simplicity). This helps overcome the curse of dimensionality and enables us to visually discern patterns and clusters in the data, which will be especially helpful in our case since we are curious about how thoughts might cluster around themes and make abrupt jumps to different topics.</p>
<p>So, we reduce the dimension of our data by running the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Concatenate all embeddings into a single array</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>all_embeddings <span class="op">=</span> np.vstack(all_embeddings)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Apply UMAP to the entire dataset of embeddings</span></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>umap_reducer <span class="op">=</span> umap.UMAP()</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>all_umap_embeddings <span class="op">=</span> umap_reducer.fit_transform(all_embeddings)</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>umap_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'subject_id'</span>: subject_ids,</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'UMAP1'</span>: all_umap_embeddings[:, <span class="dv">0</span>],</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'UMAP2'</span>: all_umap_embeddings[:, <span class="dv">1</span>]</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>    })</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can then plot some of our data to see how whether we can visually see various any clusters of thoughts emerge.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>subset <span class="op">=</span> umap_df[<span class="dv">30000</span>:<span class="dv">50000</span>]</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>,<span class="dv">8</span>))</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>plt.scatter(</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    subset[<span class="st">'UMAP1'</span>],</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    subset[<span class="st">'UMAP2'</span>],</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    s <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    alpha <span class="op">=</span> <span class="fl">0.5</span>, </span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    color <span class="op">=</span> <span class="st">"red"</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Great! We can see how certain thoughts seem to be grouping together in space. We can bring a little more clarity to this visualization by mapping each subject to a unique color.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a unique color for each unique subject_id</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> sns.color_palette(<span class="st">"hsv"</span>, n_colors<span class="op">=</span><span class="bu">len</span>(subset[<span class="st">'subject_id'</span>].unique()))  </span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>color_map <span class="op">=</span> {subject: color <span class="cf">for</span> subject, color <span class="kw">in</span> <span class="bu">zip</span>(subset[<span class="st">'subject_id'</span>].unique(), palette)}</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Map each subject_id to its color in the subset</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>subset[<span class="st">'color'</span>] <span class="op">=</span> subset[<span class="st">'subject_id'</span>].<span class="bu">map</span>(color_map)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>plt.scatter(</span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>    subset[<span class="st">'UMAP1'</span>],</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a>    subset[<span class="st">'UMAP2'</span>],</span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span>subset[<span class="st">'color'</span>]  <span class="co"># Use the mapped colors</span></span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'UMAP Projection of a subset of thoughts'</span>)</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-11-3.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Coloring each thought based on which person uttered it helps reveal this “clump-and-jump” thought structure that we expected to see.</p>
<p>Look at the pink subject for example. We can see how their thoughts have clustered in a few different areas.</p>
<p>Different subjects also seem to cover different numbers of topics and stay on topics for different amounts of time. For instance, the subject in light blue seems to have spent a lot of time thinking about a topic around coordinates (25,8).</p>
<p>It’s also fun to see the overlap in what subjects thought about!</p>
</section>
</section>
<section id="clustering-our-data" class="level2">
<h2 class="anchored" data-anchor-id="clustering-our-data">Clustering our data</h2>
<p>With each thought now represented as a 2D embedding, we can categorize these thoughts into groups of similar observations using a clustering algorithm. K-means clustering is one of the most commonly used methods for this purpose thanks to its efficiency in grouping data. The primary aim of K-means clustering is to organize the data into clusters where members of a same cluster are as similar as possible, while members of different clusters are as dissimilar as possible.</p>
<p><em>How exactly does the algorithm work?</em></p>
<p>One key concept for understand k-means clustering is the idea of a a “centroid” , which is the average position of all the data points within a cluster. The centroid acts as the cluster’s center but it may not necessarily be a point orginally from that dataset.</p>
<p>K-means begins by determining a fixed number of clusters, represented by the variable <strong><code>k</code></strong>. For instance, setting <strong><code>k</code></strong> to 2 will split the dataset into two clusters, and setting it to 4 will create four clusters. Once a number of clusters is selected, the procedure works by:</p>
<ol type="1">
<li>First, the algorithm selects random data points as initial centroids for the assigned number of clusters. If <strong><code>k</code></strong> is set to 3, it randomly picks 3 initial centroids.</li>
<li>Next, K-means assigns each data point to the nearest centroid, effectively placing it in the specific cluster where the centroid acts as a nucleus.</li>
<li>After assignment, K-means recalculates each cluster’s centroid by averaging all the points assigned to that cluster, thereby reducing the total variance within the cluster. As new centroids are determined, data points are reassigned to the closest centroid.</li>
</ol>
<p>This process of recalculating centroids and reassigning data points repeats until one of three conditions is met: the total distance between points and their respective centroids no longer decreases significantly, a preset number of iterations is reached, or the centroids stabilize and cease to change.</p>
<p><em>How can we select a number of clusters?</em></p>
<p>It might seem difficult and subjective to chose a number of expected clusters/topics within our dataset. Instead of making that decision like a shot in the dark, we can use a popular technique for selecting a number of clusters: the Elbow Method. The method involves running the clustering algorithm several times over a range of values for k and plotting the results to find the point at which the improvement in the clustering results diminishes as k increases. This point is often referred to as the “elbow,” where adding more clusters does not provide much better modeling of the data. We can define improvement in the clustering results by looking at the total within-cluster sum of square (WSS). It measures the compactness of the clusters and is defined as the sum of the squared distances between each observation and its closest centroid. Essentially, it measures how close each point in a cluster is to the centroid.</p>
<p>So, let’s apply k-means clustering to our dataset with different numbers of clusters. Given that we have 70,000+ thoughts, a k ranging from 100-1000 seems like it could work, but we can always readjust our numbers based on the plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cluster_and_save(num_clusters):</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>    kmeans <span class="op">=</span> KMeans(n_clusters<span class="op">=</span>num_clusters)</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>    clusters <span class="op">=</span> kmeans.fit_predict(all_umap_embeddings)</span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>    inertia <span class="op">=</span> kmeans.inertia_</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># Create the DataFrame with cluster assignments</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> pd.DataFrame({</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>        <span class="st">'subject_id'</span>: umap_df[<span class="st">'subject_id'</span>],</span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a>        <span class="st">'cluster'</span>: clusters,</span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a>        <span class="st">'UMAP1'</span>: umap_df[<span class="st">'UMAP1'</span>],</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>        <span class="st">'UMAP2'</span>: umap_df[<span class="st">'UMAP2'</span>]</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> inertia, results_df</span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a><span class="co"># List of number of clusters to try</span></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a>num_clusters_list <span class="op">=</span> [<span class="dv">100</span>, <span class="dv">150</span>, <span class="dv">200</span>, <span class="dv">250</span>, <span class="dv">300</span>, <span class="dv">350</span>, <span class="dv">400</span>, <span class="dv">450</span>, <span class="dv">500</span>, <span class="dv">550</span>, <span class="dv">600</span>, <span class="dv">650</span>, <span class="dv">700</span>, <span class="dv">750</span>, <span class="dv">800</span>, <span class="dv">850</span>, <span class="dv">900</span>, <span class="dv">950</span>, <span class="dv">1000</span>]</span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>inertias <span class="op">=</span> []</span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> num_clusters <span class="kw">in</span> num_clusters_list:</span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>    inertia, results_df <span class="op">=</span> cluster_and_save(num_clusters)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>    inertias.append(inertia)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a>plt.plot(num_clusters_list, inertias, marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb10-27"><a href="#cb10-27" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Elbow Plot for K-Means Clustering'</span>)</span>
<span id="cb10-28"><a href="#cb10-28" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Number of Clusters'</span>)</span>
<span id="cb10-29"><a href="#cb10-29" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Inertia'</span>)</span>
<span id="cb10-30"><a href="#cb10-30" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb10-31"><a href="#cb10-31" aria-hidden="true" tabindex="-1"></a>plt.xticks(num_clusters_list)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>([&lt;matplotlib.axis.XTick object at 0x32c787460&gt;, &lt;matplotlib.axis.XTick object at 0x32c785f00&gt;, &lt;matplotlib.axis.XTick object at 0x32c787580&gt;, &lt;matplotlib.axis.XTick object at 0x32a6781c0&gt;, &lt;matplotlib.axis.XTick object at 0x32a62f2e0&gt;, &lt;matplotlib.axis.XTick object at 0x32a6b33a0&gt;, &lt;matplotlib.axis.XTick object at 0x32a6b2b00&gt;, &lt;matplotlib.axis.XTick object at 0x32a679d20&gt;, &lt;matplotlib.axis.XTick object at 0x32a6b24a0&gt;, &lt;matplotlib.axis.XTick object at 0x32aca76d0&gt;, &lt;matplotlib.axis.XTick object at 0x32aca5c90&gt;, &lt;matplotlib.axis.XTick object at 0x32aca6fb0&gt;, &lt;matplotlib.axis.XTick object at 0x32a6794e0&gt;, &lt;matplotlib.axis.XTick object at 0x32aca5db0&gt;, &lt;matplotlib.axis.XTick object at 0x32aca7550&gt;, &lt;matplotlib.axis.XTick object at 0x32ac88790&gt;, &lt;matplotlib.axis.XTick object at 0x32ac88100&gt;, &lt;matplotlib.axis.XTick object at 0x32aca47c0&gt;, &lt;matplotlib.axis.XTick object at 0x32ac3cc70&gt;], [Text(100, 0, '100'), Text(150, 0, '150'), Text(200, 0, '200'), Text(250, 0, '250'), Text(300, 0, '300'), Text(350, 0, '350'), Text(400, 0, '400'), Text(450, 0, '450'), Text(500, 0, '500'), Text(550, 0, '550'), Text(600, 0, '600'), Text(650, 0, '650'), Text(700, 0, '700'), Text(750, 0, '750'), Text(800, 0, '800'), Text(850, 0, '850'), Text(900, 0, '900'), Text(950, 0, '950'), Text(1000, 0, '1000')])</code></pre>
</div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-13-5.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Our elbow plot does not reveal a specific elbow where inertia stops declining. However, it does suggest a range of values after which the decline in inertia is much smaller. According to this metric, the number of clusters we should use likely ranges between 350 and 600 or so.</p>
<p>We can turn to a couple of other metrics to help us make a decision regarding what value of k we should use when clustering. For example, according to prior work that used human annotators to identify thought jumps, we can expect subjects to switch topics 20-30 times within the 10 minutes of speaking, and each topic can be expect to contain around 4-6 thoughts.</p>
<p>Further, given the “clump-and-jump” nature of thought, we should expect thought to be more similar within a cluster, and then lowly similar when there’s a jump to a new topic.</p>
<p>Thus, we can compare these different values (i.e.&nbsp;average number of clusters <em>per subject</em>, average number of thoughts per cluster, difference in semantic similarity within and between clusters) to see for which value of k these metrics most closely resemble what we would expect.</p>
<p>The following code calculates those measures for each cluster value, and we can then plot them to identify an optimal value of k.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>summary_data <span class="op">=</span> {}</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> num_clusters <span class="kw">in</span> num_clusters_list:</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    inertia, results_df <span class="op">=</span> cluster_and_save(num_clusters)</span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    results_df[<span class="st">'thought_number'</span>] <span class="op">=</span> results_df.groupby(<span class="st">'subject_id'</span>).cumcount() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>    merged_data <span class="op">=</span> results_df.merge(data, on<span class="op">=</span>[<span class="st">'subject_id'</span>, <span class="st">'thought_number'</span>], how<span class="op">=</span><span class="st">'left'</span>)</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a>    merged_data[<span class="st">'jump'</span>] <span class="op">=</span> merged_data.groupby(<span class="st">'subject_id'</span>)[<span class="st">'cluster'</span>].diff().ne(<span class="dv">0</span>)</span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>    merged_data[<span class="st">'jump'</span>] <span class="op">=</span> merged_data[<span class="st">'jump'</span>].astype(<span class="st">'boolean'</span>)</span>
<span id="cb12-12"><a href="#cb12-12" aria-hidden="true" tabindex="-1"></a>    merged_data.loc[merged_data.groupby(<span class="st">'subject_id'</span>).head(<span class="dv">1</span>).index, <span class="st">'jump'</span>] <span class="op">=</span> <span class="va">False</span></span>
<span id="cb12-13"><a href="#cb12-13" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-14"><a href="#cb12-14" aria-hidden="true" tabindex="-1"></a>    subjects_with_jumps <span class="op">=</span> merged_data.groupby(<span class="st">'subject_id'</span>)[<span class="st">'jump'</span>].<span class="bu">sum</span>()</span>
<span id="cb12-15"><a href="#cb12-15" aria-hidden="true" tabindex="-1"></a>    subjects_with_jumps <span class="op">=</span> subjects_with_jumps[subjects_with_jumps <span class="op">&gt;</span> <span class="dv">0</span>].index</span>
<span id="cb12-16"><a href="#cb12-16" aria-hidden="true" tabindex="-1"></a>    filtered_data <span class="op">=</span> merged_data[merged_data[<span class="st">'subject_id'</span>].isin(subjects_with_jumps)]</span>
<span id="cb12-17"><a href="#cb12-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-18"><a href="#cb12-18" aria-hidden="true" tabindex="-1"></a>    total_clusters <span class="op">=</span> filtered_data.groupby(<span class="st">'subject_id'</span>)[<span class="st">'cluster'</span>].nunique()</span>
<span id="cb12-19"><a href="#cb12-19" aria-hidden="true" tabindex="-1"></a>    total_jumps <span class="op">=</span> filtered_data.groupby(<span class="st">'subject_id'</span>)[<span class="st">'jump'</span>].<span class="bu">sum</span>()</span>
<span id="cb12-20"><a href="#cb12-20" aria-hidden="true" tabindex="-1"></a>    mean_sem_sim_jump <span class="op">=</span> filtered_data[filtered_data[<span class="st">'jump'</span>]][<span class="st">'Previous_Thought_Similarity'</span>].groupby(filtered_data[<span class="st">'subject_id'</span>]).mean().fillna(<span class="dv">0</span>)</span>
<span id="cb12-21"><a href="#cb12-21" aria-hidden="true" tabindex="-1"></a>    mean_sem_sim_non_jump <span class="op">=</span> filtered_data[<span class="op">~</span>filtered_data[<span class="st">'jump'</span>]][<span class="st">'Previous_Thought_Similarity'</span>].groupby(filtered_data[<span class="st">'subject_id'</span>]).mean().fillna(<span class="dv">0</span>)</span>
<span id="cb12-22"><a href="#cb12-22" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-23"><a href="#cb12-23" aria-hidden="true" tabindex="-1"></a>    diff_mean_sem_sim <span class="op">=</span> mean_sem_sim_non_jump <span class="op">-</span> mean_sem_sim_jump </span>
<span id="cb12-24"><a href="#cb12-24" aria-hidden="true" tabindex="-1"></a>    thoughts_per_cluster <span class="op">=</span> filtered_data.groupby([<span class="st">'subject_id'</span>, <span class="st">'cluster'</span>]).size().reset_index(name<span class="op">=</span><span class="st">'thoughts'</span>)</span>
<span id="cb12-25"><a href="#cb12-25" aria-hidden="true" tabindex="-1"></a>    mean_thoughts_per_cluster <span class="op">=</span> thoughts_per_cluster.groupby(<span class="st">'subject_id'</span>)[<span class="st">'thoughts'</span>].mean().fillna(<span class="dv">0</span>)</span>
<span id="cb12-26"><a href="#cb12-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb12-27"><a href="#cb12-27" aria-hidden="true" tabindex="-1"></a>    summary_data[num_clusters] <span class="op">=</span> pd.DataFrame({</span>
<span id="cb12-28"><a href="#cb12-28" aria-hidden="true" tabindex="-1"></a>        <span class="st">'subject_id'</span>: total_clusters.index,</span>
<span id="cb12-29"><a href="#cb12-29" aria-hidden="true" tabindex="-1"></a>        <span class="st">'total_clusters'</span>: total_clusters.values,</span>
<span id="cb12-30"><a href="#cb12-30" aria-hidden="true" tabindex="-1"></a>        <span class="st">'total_jumps'</span>: total_jumps.values,</span>
<span id="cb12-31"><a href="#cb12-31" aria-hidden="true" tabindex="-1"></a>        <span class="st">'mean_sem_sim_jump'</span>: mean_sem_sim_jump.values,</span>
<span id="cb12-32"><a href="#cb12-32" aria-hidden="true" tabindex="-1"></a>        <span class="st">'mean_sem_sim_non_jump'</span>: mean_sem_sim_non_jump.values,</span>
<span id="cb12-33"><a href="#cb12-33" aria-hidden="true" tabindex="-1"></a>        <span class="st">'mean_thoughts_per_cluster'</span>: mean_thoughts_per_cluster.values,</span>
<span id="cb12-34"><a href="#cb12-34" aria-hidden="true" tabindex="-1"></a>        <span class="st">'diff_mean_sem_sim'</span>: diff_mean_sem_sim.values</span>
<span id="cb12-35"><a href="#cb12-35" aria-hidden="true" tabindex="-1"></a>    })</span>
<span id="cb12-36"><a href="#cb12-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-37"><a href="#cb12-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Combine all the summary data</span></span>
<span id="cb12-38"><a href="#cb12-38" aria-hidden="true" tabindex="-1"></a>all_summary <span class="op">=</span> pd.concat(summary_data.values(), keys<span class="op">=</span>summary_data.keys(), names<span class="op">=</span>[<span class="st">'cutoff'</span>, <span class="st">'row'</span>]).reset_index(level<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb12-39"><a href="#cb12-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-40"><a href="#cb12-40" aria-hidden="true" tabindex="-1"></a>mean_metrics <span class="op">=</span> all_summary.groupby(<span class="st">'cutoff'</span>).agg({</span>
<span id="cb12-41"><a href="#cb12-41" aria-hidden="true" tabindex="-1"></a>    <span class="st">'total_clusters'</span>: <span class="st">'mean'</span>,</span>
<span id="cb12-42"><a href="#cb12-42" aria-hidden="true" tabindex="-1"></a>    <span class="st">'total_jumps'</span>: <span class="st">'mean'</span>,</span>
<span id="cb12-43"><a href="#cb12-43" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mean_sem_sim_jump'</span>: <span class="st">'mean'</span>,</span>
<span id="cb12-44"><a href="#cb12-44" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mean_sem_sim_non_jump'</span>: <span class="st">'mean'</span>,</span>
<span id="cb12-45"><a href="#cb12-45" aria-hidden="true" tabindex="-1"></a>    <span class="st">'mean_thoughts_per_cluster'</span>: <span class="st">'mean'</span>,</span>
<span id="cb12-46"><a href="#cb12-46" aria-hidden="true" tabindex="-1"></a>    <span class="st">'diff_mean_sem_sim'</span>: <span class="st">'mean'</span></span>
<span id="cb12-47"><a href="#cb12-47" aria-hidden="true" tabindex="-1"></a>}).reset_index()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>plt.plot(mean_metrics[<span class="st">'cutoff'</span>], mean_metrics[<span class="st">'total_clusters'</span>], marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span><span class="dv">450</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Mean Total Clusters by Cutoff'</span>)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cutoff'</span>)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Mean Total Clusters'</span>)</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-15-7.png" class="img-fluid" width="960"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>plt.plot(mean_metrics[<span class="st">'cutoff'</span>], mean_metrics[<span class="st">'mean_thoughts_per_cluster'</span>], marker<span class="op">=</span><span class="st">'o'</span>)</span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span><span class="dv">450</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Mean Thoughts per Cluster by Cutoff'</span>)</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cutoff'</span>)</span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Mean Thoughts per Cluster'</span>)</span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-16-9.png" class="img-fluid" width="960"></p>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assuming `mean_metrics` is your DataFrame with 'cutoff' and 'diff_mean_sem_sim' columns</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>))</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>plt.plot(mean_metrics[<span class="st">'cutoff'</span>], mean_metrics[<span class="st">'diff_mean_sem_sim'</span>], marker<span class="op">=</span><span class="st">'o'</span>, label<span class="op">=</span><span class="st">'Mean Semantic Similarity Difference'</span>)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a vertical red line at 450 clusters</span></span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>plt.axvline(x<span class="op">=</span><span class="dv">450</span>, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'Difference in Mean Semantic Similarity at Jumps vs Non-Jumps by Cutoff'</span>)</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">'Cutoff'</span>)</span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>plt.ylabel(<span class="st">'Difference in Mean Semantic Similarity'</span>)</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a>plt.grid(<span class="va">True</span>)</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Add a legend to explain the red line</span></span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a>plt.legend()</span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-17-11.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>Visual inspection of the graphs reveals that using 450 clusters results in an appropriate number of average cluster per subject (i.e.&nbsp;23), of thoughts per topic (5) and a high difference in semantic similarity within compared to across topic jumps.</p>
<p>So, using these metrics, we can make an informed decision to use 450 clusters.</p>
<p>We can now re-run our clustering using only k = 450, and use the results to assign each thought to a cluster.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>inertia, results_df <span class="op">=</span> cluster_and_save(<span class="dv">450</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>results_df[<span class="st">'thought_number'</span>] <span class="op">=</span> results_df.groupby(<span class="st">'subject_id'</span>).cumcount() <span class="op">+</span> <span class="dv">1</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="co">#Merge the cluster information to thought level data</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>thoughts_with_clusters <span class="op">=</span> results_df.merge(</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    data,</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span>[<span class="st">'subject_id'</span>, <span class="st">'thought_number'</span>],</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    how<span class="op">=</span><span class="st">'left'</span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(thoughts_with_clusters[[<span class="st">'cluster'</span>,<span class="st">'thought'</span>]][<span class="dv">500</span>:<span class="dv">530</span>], headers<span class="op">=</span><span class="st">'keys'</span>, tablefmt<span class="op">=</span><span class="st">'psql'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-----+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|     |   cluster | thought                                                                                                                                                                                                                                                                                                             |
|-----+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 500 |       154 | My husband had to go into work today despite all the schools and stuff being called off and I was worried about him getting to work but he made it alright.                                                                                                                                                         |
| 501 |       154 | I worry about him a lot.                                                                                                                                                                                                                                                                                            |
| 502 |       294 | I have anxiety issues which just... is what it is.                                                                                                                                                                                                                                                                  |
| 503 |        43 | With it being this cold out our house isn't heated the greatest so we have to keep it as warm as possible especially because I have a newborn and                                                                                                                                                                   |
| 504 |       181 | she can't be cold.                                                                                                                                                                                                                                                                                                  |
| 505 |       271 | We can't let her get too cold so I'm diligent about making sure the heat stays on despite the cost of it and her room is always heated so there's always at least one place in the house I can take her to make sure she's always comfortable.                                                                      |
| 506 |       181 | She woke up just a little bit ago and                                                                                                                                                                                                                                                                               |
| 507 |       181 | has been rolling around in her crib while I can get some stuff done.                                                                                                                                                                                                                                                |
| 508 |       181 | She's generally a very happy baby.                                                                                                                                                                                                                                                                                  |
| 509 |        80 | She doesn't get grumpy very often.                                                                                                                                                                                                                                                                                  |
| 510 |       181 | She has baby reflux and that's the only time she gets grumpy is when that flares up.                                                                                                                                                                                                                                |
| 511 |       181 | So we have to treat her for it.                                                                                                                                                                                                                                                                                     |
| 512 |        43 | It's currently about eleven nineteen in the morning.                                                                                                                                                                                                                                                                |
| 513 |        16 | I've been trying to work on my art skills recently and                                                                                                                                                                                                                                                              |
| 514 |       294 | have been dealing with some issues with that.                                                                                                                                                                                                                                                                       |
| 515 |       294 | Kind of sucks because I have this internal thought that I'm better than what I am.                                                                                                                                                                                                                                  |
| 516 |       417 | And then when I have to go and practice                                                                                                                                                                                                                                                                             |
| 517 |       294 | and I realize that I'm not at the standard that I want to be for myself I get kind of upset with myself.                                                                                                                                                                                                            |
| 518 |        16 | But that's part of the reason why I'm practicing my New Year's resolution this year is to Practice more art and get to a place where I'm not so self-deprecating all the time I've done art since I was very little I did take some college courses for it but Had not a great time with some of the teachers there |
| 519 |        16 | and it is what it is at this point I've been talking to my friend Lindsay a lot more who also does art                                                                                                                                                                                                              |
| 520 |        80 | and She's been doing a lot more art and I'm really proud of her for it.                                                                                                                                                                                                                                             |
| 521 |        80 | She also has to deal with self-deprecating thoughts and actions when it comes to her art even though she's much better than I am and It's been nice Helping her get through that even though She still doesn't see it the way that I see it which is fine.                                                          |
| 522 |        80 | It always takes time in those sorts of situations she's really been working on herself and she's been going to therapy for it.                                                                                                                                                                                      |
| 523 |        16 | I actually just stopped going to therapy myself because because I lost another therapist not to anything that is my own just not my problem just simply that they were moving on to another facility that I couldn't follow them at.                                                                                |
| 524 |       321 | And that's fine.                                                                                                                                                                                                                                                                                                    |
| 525 |        16 | Um and I think that just my therapy journey has come to an end.                                                                                                                                                                                                                                                     |
| 526 |        16 | And if I need to have more counseling in the future that's fine.                                                                                                                                                                                                                                                    |
| 527 |       257 | I will reach out to anyone that I need to um this experiment.                                                                                                                                                                                                                                                       |
| 528 |       257 | This study is interesting.                                                                                                                                                                                                                                                                                          |
| 529 |       257 | It's making me realize how all over the place my thoughts can be sometimes.                                                                                                                                                                                                                                         |
+-----+-----------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</code></pre>
</div>
</div>
<p>We can see when subsequent thoughts belong to the same versus a different cluster; if consecutive thoughts belong to different clusters, that indicates a topic switch, we can identify by create a column called “jump” and assigning that row the value of TRUE.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>thoughts_with_clusters[<span class="st">'jump'</span>] <span class="op">=</span> thoughts_with_clusters.groupby(<span class="st">'subject_id'</span>)[<span class="st">'cluster'</span>].diff().ne(<span class="dv">0</span>)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a> </span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(tabulate(thoughts_with_clusters[[<span class="st">'cluster'</span>,<span class="st">'jump'</span>, <span class="st">'thought'</span>]][<span class="dv">500</span>:<span class="dv">530</span>], headers<span class="op">=</span><span class="st">'keys'</span>, tablefmt<span class="op">=</span><span class="st">'psql'</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>+-----+-----------+--------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+
|     |   cluster | jump   | thought                                                                                                                                                                                                                                                                                                             |
|-----+-----------+--------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 500 |       154 | True   | My husband had to go into work today despite all the schools and stuff being called off and I was worried about him getting to work but he made it alright.                                                                                                                                                         |
| 501 |       154 | False  | I worry about him a lot.                                                                                                                                                                                                                                                                                            |
| 502 |       294 | True   | I have anxiety issues which just... is what it is.                                                                                                                                                                                                                                                                  |
| 503 |        43 | True   | With it being this cold out our house isn't heated the greatest so we have to keep it as warm as possible especially because I have a newborn and                                                                                                                                                                   |
| 504 |       181 | True   | she can't be cold.                                                                                                                                                                                                                                                                                                  |
| 505 |       271 | True   | We can't let her get too cold so I'm diligent about making sure the heat stays on despite the cost of it and her room is always heated so there's always at least one place in the house I can take her to make sure she's always comfortable.                                                                      |
| 506 |       181 | True   | She woke up just a little bit ago and                                                                                                                                                                                                                                                                               |
| 507 |       181 | False  | has been rolling around in her crib while I can get some stuff done.                                                                                                                                                                                                                                                |
| 508 |       181 | False  | She's generally a very happy baby.                                                                                                                                                                                                                                                                                  |
| 509 |        80 | True   | She doesn't get grumpy very often.                                                                                                                                                                                                                                                                                  |
| 510 |       181 | True   | She has baby reflux and that's the only time she gets grumpy is when that flares up.                                                                                                                                                                                                                                |
| 511 |       181 | False  | So we have to treat her for it.                                                                                                                                                                                                                                                                                     |
| 512 |        43 | True   | It's currently about eleven nineteen in the morning.                                                                                                                                                                                                                                                                |
| 513 |        16 | True   | I've been trying to work on my art skills recently and                                                                                                                                                                                                                                                              |
| 514 |       294 | True   | have been dealing with some issues with that.                                                                                                                                                                                                                                                                       |
| 515 |       294 | False  | Kind of sucks because I have this internal thought that I'm better than what I am.                                                                                                                                                                                                                                  |
| 516 |       417 | True   | And then when I have to go and practice                                                                                                                                                                                                                                                                             |
| 517 |       294 | True   | and I realize that I'm not at the standard that I want to be for myself I get kind of upset with myself.                                                                                                                                                                                                            |
| 518 |        16 | True   | But that's part of the reason why I'm practicing my New Year's resolution this year is to Practice more art and get to a place where I'm not so self-deprecating all the time I've done art since I was very little I did take some college courses for it but Had not a great time with some of the teachers there |
| 519 |        16 | False  | and it is what it is at this point I've been talking to my friend Lindsay a lot more who also does art                                                                                                                                                                                                              |
| 520 |        80 | True   | and She's been doing a lot more art and I'm really proud of her for it.                                                                                                                                                                                                                                             |
| 521 |        80 | False  | She also has to deal with self-deprecating thoughts and actions when it comes to her art even though she's much better than I am and It's been nice Helping her get through that even though She still doesn't see it the way that I see it which is fine.                                                          |
| 522 |        80 | False  | It always takes time in those sorts of situations she's really been working on herself and she's been going to therapy for it.                                                                                                                                                                                      |
| 523 |        16 | True   | I actually just stopped going to therapy myself because because I lost another therapist not to anything that is my own just not my problem just simply that they were moving on to another facility that I couldn't follow them at.                                                                                |
| 524 |       321 | True   | And that's fine.                                                                                                                                                                                                                                                                                                    |
| 525 |        16 | True   | Um and I think that just my therapy journey has come to an end.                                                                                                                                                                                                                                                     |
| 526 |        16 | False  | And if I need to have more counseling in the future that's fine.                                                                                                                                                                                                                                                    |
| 527 |       257 | True   | I will reach out to anyone that I need to um this experiment.                                                                                                                                                                                                                                                       |
| 528 |       257 | False  | This study is interesting.                                                                                                                                                                                                                                                                                          |
| 529 |       257 | False  | It's making me realize how all over the place my thoughts can be sometimes.                                                                                                                                                                                                                                         |
+-----+-----------+--------+---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+</code></pre>
</div>
</div>
<p>And we can also visualise how our clustering performed! We can plot our thought-space again, but instead of coloring data points by subject, we can color by topic to see whether thought that are closer in space belong to the same topics.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>subset <span class="op">=</span> thoughts_with_clusters[<span class="dv">30000</span>:<span class="dv">50000</span>]</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Generate a unique color for each unique subject_id</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>palette <span class="op">=</span> sns.color_palette(<span class="st">"hsv"</span>, n_colors<span class="op">=</span><span class="bu">len</span>(subset[<span class="st">'cluster'</span>].unique()))  </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>color_map <span class="op">=</span> {subject: color <span class="cf">for</span> subject, color <span class="kw">in</span> <span class="bu">zip</span>(subset[<span class="st">'cluster'</span>].unique(), palette)}</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>subset[<span class="st">'color'</span>] <span class="op">=</span> subset[<span class="st">'cluster'</span>].<span class="bu">map</span>(color_map)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">8</span>))</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>plt.scatter(</span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>    subset[<span class="st">'UMAP1'</span>],</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>    subset[<span class="st">'UMAP2'</span>],</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>    s<span class="op">=</span><span class="fl">0.5</span>,</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>    alpha<span class="op">=</span><span class="dv">1</span>,</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span>subset[<span class="st">'color'</span>]  <span class="co"># Use the mapped colors</span></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>plt.title(<span class="st">'UMAP Projection of a subset of thoughts'</span>)</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="index_files/figure-html/unnamed-chunk-21-13.png" class="img-fluid" width="960"></p>
</div>
</div>
<p>And that seems to be the case!</p>
<p>In all, I hope this tutorial helped show how we can identify topic switches in spontaneous thought data. Thanks for reading!</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>